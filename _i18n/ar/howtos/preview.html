<div class="container">

<h2>HowTo: Adding a preview function to OmegaT</h2>

<h3>Background</h3>

<p>Most modern CAT tools display the text in segment-oriented form rather than with its ultimate layout and formatting. Although this has many advantages, it can be very useful for the translator to be able to see the ultimate layout and formatting whilst translating. For this reason, many CAT tools provide a "preview" function that shows the layout and formatting without the translator having to create the final document and open it in a separate application (usually a word processor). OmegaT does not have an integral preview function, but it is possible to provide much the same functionality using additional software. This HowTo describes how a preview function can be set up.</p>

<h3>Principles</h3>

<p>There are many ways in which a preview function can be created, and this HowTo describes several of them. However, <b><i>don't expect to be able to achieve this with just a few clicks</i></b>. Whatever solution you choose, you must follow the instructions carefully and, above all, <i>understand the principles</i>.</p>

<p>Ideally, a viewer should do two things:</p>

<p>1. It should display the text with something approaching the final layout and formatting.<br/>
2. It should be updated continually.</p>


<h3>Browser</h3>

<p>If you are translating .html files, a convenient solution is to use a browser with an automatic refresh function to provide a ready-made preview function. Examples of browsers with an automatic refresh function:</p>

<ul>

<li>Firefox:<br/>
Windows users who are not already using Firefox can <a href="http://www.mozilla.org">download it from www.mozilla.org</a>; most Linux users will already have it installed, or can install it via their distributions' repositories. To add an automatic refresh function to Firefox, <a href="http://addons.mozilla.org/de/firefox/addon/reloadevery/">install the "ReloadEvery" add-on</a>.

<li>Opera:<br/>
Opera is available for all platforms; it is also very fast and requires low hardware resources. <a href="http://www.opera.com">Download it from www.opera.com</a> (or for Linux users: through your distribution's repository). The automatic refresh function is built in.

<li>Chrome:<br/>
Chrome is also available for all platforms. <a href="http://www.google.com/chrome">Download Chrome from www.google.com/chrome</a>. To add the auto refresh function to Chrome, <a href="http://chrome.google.com/webstore/detail/oilipfekkmncanaajkapbpancpelijih">download and install the Auto Refresh Plus extension</a> from the Web Store. </i>

</ul>

<p>You may prefer <i>not</i> to use your usual browser for the preview function so as to keep it free for Internet browsing rather than having constantly to switch tabs, so you can regard installing an additional browser for the preview function as an advantage.</p>

<p>After selecting and installing a suitable browser (and/or the required add-on), open your translated file in the /target folder of your project:</p>

<ul>

<li>Using Firefox: with File > Open File
<li>Using Opera: with Opera > Page > Open
<li>Using Chrome: with Ctrl+o (Mac users: âŒ˜-O)

</ul>

<p>Now enable automatic refreshing. In both Firefox and Opera, this can be done by right-clicking in the translated .html file you have opened, then Reload every > select a desired interval (e.g. 5 seconds). In Chrome, hit the Auto Refresh button in the extension section. <i>Note: I have not tested this function in Chrome</i>.</p>

<p>You now have a preview function. To update the display, you must still save and create your target document in OmegaT with Ctrl+s, Ctrl+d. The change will then become visible after a delay of at most the interval you selected. Your browser won't automatically scroll as you work through the text; you have to do that yourself. But it will at least stay at the same point in the text when the view is updated.</p>

<h3>Previewing word-processing files</h3>

<p>Opening your translated target file in a browser is easy when your source file is in .html format, but translations more often involve word-processing files, which in OmegaT are handled in .docx or .odt format. You can still use the browser solution described above to preview the translations of these files, but you will then also need a) a converter to convert the file to .html format, and b) a utility to launch the converter automatically so that you don't have to convert the files manually.</p>

<p>Three conversion utilities are described here: Abiword, LibreOffice and Textutil.</p>

<p>Abiword and LibreOffice are a word processor and office suite respectively. Both are free, available for a number of different platforms, and can convert .docx and .odt files to .html format.</p>

<p>Abiword is a relatively small download and is very fast in use. It has a command-line function for converting .docx and .odt files to .html format. It is very easy for Linux users and fairly easy for Windows users to install; installing on a Mac is tricker and Mac users may prefer to use an alternative. <a href="http://www.abisource.com/download/">Download Abiword here</a>.</p>

<p>LibreOffice is a fully-functioned office suite similar to Microsoft Office. It can also be used to convert .docx and .odt files to .html format, but to do so from the command line, it also requires Unoconv, a plug-in. <a href="http://www.libreoffice.org/">Download LibreOffice here</a>; <a href="http://dag.wieers.com/home-made/unoconv/">download the Unoconv plug-in here</a>.</p>

<p>If you are using macOS, you can use the preinstalled Textutil utility. (<i>Linux users: don't confuse this with the Linux Textutil utility, which is completely unrelated.</i>)</p>

<h3>The preview.tcl listener script</h3>

<p>Although you could use Abiword or LibreOffice to convert from .docx or .odt to .html, it would be impractical to do so repeatedly during the translation process. A more efficient alternative is to use a script that "listens" for a change in your translated file (i.e. it detects when the file has been updated, which happens when you hit Ctrl+s, Ctrl+d in OmegaT), and then launches the converter which converts the file to .html. A script named preview.tcl is available for this purpose. It is written in the tcl/tk scripting language, and therefore requires tcl/tk to run.</p>

<p>To use preview.tcl:</p>

<p>Windows users: <a href="http://www.tcl.tk/software/tcltk/">Get tcl/tk here</a> and install it. If you're using Linux or macOS, you probably already have it installed. (Linux users in particular: you need both tcl and tk, not just tcl.)</p>

<p>Everyone: <a href="/files/preview.zip">Download preview.zip</a>. Unzip the files and put them anywhere you like (but in the same folder). Open a command prompt/terminal/console and type in:</p>

<p align="center">cd <i>path</i>

<p>where <i>path</i> is the full pathname of the folder in which you placed preview.tcl. Then type in:</p>

<p align="center">wish ui_preview.tcl</p>

<p>All being well, the preview.tcl interface should appear. On this, you can select the name of the target file (in /target in your OmegaT project), the frequency with which the script is to check whether this file has changed, and the file conversion utility that you have installed. When you have selected all those, you can hit the Start button.</p>

<p align="center"><img src="/img/preview_ss.png" alt="preview_ss.png"></img></p>

<p><i>A European Commission press release (in .odt format) in OmegaT and below it the instantaneous target text displayed in Opera. Bottom right: the preview.tcl utility. The layout shown here is just for the sake of example; you can of course arrange the windows as you like.</i></p>



<h3>Putting it all together</h3>

<p>By now you will have realized that to add the preview function, you may have to install and configure quite a lot of new (but thankfully free) software. Depending upon your target file format and your chosen solution, that may be as many as six(!) new pieces of software. Here's an overview:</p>

<p align="center"><img src="/img/preview_flow.png" alt="preview_flow.png"></img></p>


<h3>Summary/installation</h3>

<p>You need:</p>

<ul>

<li>Tcl/tk and preview.tcl

<li>Abiword <i>or</i> LibreOffice and Unoconv <i>or</i> Textutil

<li>A suitable browser (and possibly refresh plug-in)

</ul>

<h3>Troubleshooting</h3>

<p>Assuming that you have installed tcl/tk, preview.tcl, a converter and a suitable browser, if your target file is not being updated when you make changes in the target file, check the following:</p>

<ul>

<li><p>That you are hitting Ctrl+s, Ctrl+d in OmegaT. Until/unless you do, there will be no changes to detect/display!</p>

<li><p>That you have selected the correct file, a suitable polling interval and an intsalled file conversion utility in the preview.tcl utility, and have hit the Start button.</p>

<li><p>If you have not yet got the system to work, that the file conversion utility is installed properly and is working. You can test this with the relevant command below on the command line (terminal/console/DOS prompt). In each case, <i>file</i> is the name of a .docx or .odt file. If all is well, an .html version of the file will be produced:</p>

<p>For Abiword:</p>

<p>abiword --to=html <i>file</i></p>

<p>For Textutil:</p>

<p>textutil -convert html <i>file</i></p>

<p>For LibreOffice+Unoconv:</p>

<p>unoconv -f html <i>file</i></p>

<li><p>That you have selected the correct file in your browser, and that you have set the refresh interval. Your browser may default back to not refreshing automatically each time it is launched or a new page opened.</p>

<li><p>That you have done everything in the correct sequence: unless you have hit Ctrl+s, Ctrl+d at least once, there will be no target file for you to open with preview.tcl, and unless the converter has converted the file at least once, there will be no .html file for you to open in your browser.</p>

</ul>

<br/><br/>

<p>Copyright Marc Prior 2012</p>

</div>

